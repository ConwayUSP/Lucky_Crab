# 08. Sinais

Olá novamente! Vamos falar agora de uma estrutura muito útil disponível no Godot. **Sinais** ou _Signals_ são uma ferramenta que implementa o padrão [_Observador_](https://refactoring.guru/pt-br/design-patterns/observer), ou seja, objetos estão inscritos para serem notificados caso um sinal seja emitido. Exemplos de sinais: temporizadores, informe de dano, ação do teclado, mensagem recebida, etc.

## Criando sinais

Para criar um sinal dentro do Rust declaramos a assinatura de uma função marcada com o macro `#[signal]` dentro de um bloco `#[godot_api]`.

```rust
#[derive(GodotClass)
#[class(init, base=Node2D)]
struct Player {
    hp: u32,
    base: Base<Node2D>
}

#[godot_api]
impl INode2D for Player {
    #[signal]
    fn tomou_dano(dano: u32);
}
```

Declaramos apenas a assinatura (nome, argumentos e retorno), o corpo da função fica por responsabilidade da API do Godot. Agora queremos que essa função seja chamada sempre que nosso jogador tomar dano.

## Conectando sinais

A API oferece um meio bem legal para acessar os sinais registrados. Nossos nós podem chamar o método `signals()` que permite acessar todos os sinais registrados. Para se inscrever em um sinal, existem três formas, tudo depende de onde sua função se encontra.

### Mesmo instância/objeto

Ou seja estamos na mesma instância ou estrutura. Nesse caso utilizamos a função `connect_self` passando a função que será executada quando nosso sinal for emitido. Vejamos o exemplo do jogador, sempre que tomarmos dano, temos que atualizar nossos pontos de vida.

```rust

impl Player {
    fn on_tomou_dano(&mut self, dano: u32) {
        self.hp -= dano;
    }
} 

#[godot_api]
impl INode2D for Player {
    #[signal]
    fn tomou_dano(dano: u32);

    fn ready(&mut self) {
        self.signals()
            .tomou_dano()
            .connect_self(Self::on_tomou_dano);
    }
}
```

Declaramos nossa função inscrita `on_tomou_dano` (é comum utilizar o prefixo `on` nesses casos), que atualiza a vida do jogador. Já na função `ready`, conectamos o nosso sinal com essa função. Assim dizemos que `on_tomou_dano` está inscrita para receber sinais de `tomou_dano`. 

###  Objetos diferentes

:TODO

### Funções estáticas/sem objetos

:TODO

## Emitindo sinais

:TODO

