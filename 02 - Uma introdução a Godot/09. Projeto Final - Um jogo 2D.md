# Projeto Final

Muito bem caro aluno! Se você chegou até aqui foi graças ao seu esforço e perseverança. Você teve uma introdução à linguagem Rust e ao Game Engine Godot e como utilizá-los juntos. Agora chegou a hora de construirmos um jogo juntos para colocar em prática tudo que aprendemos.

## Especificações

O jogo que iremos construir se chama *"Dodge the Creeps"* ("Desvie das Criaturas"), será uma adaptação do jogo tutorial feito pelo Tutorial Oficial do Godot, a diferença é que usaremos Rust ao invés de GDScript. Isso é ótimo pois teremos um ponto de referência para o nosso projeto, o qual podemos voltar para comparar e tirar dúvidas. Se quiser ver o tutorial original [clique aqui](https://docs.godotengine.org/pt-br/4.x/getting_started/first_2d_game/).

> Nota: utilizaremos os mesmos assets (imagens e etc) que o tutorial original. Produzido por eles. Todos os direitos são reservados ao Godot Engine.

Ademais, o código fonte do projeto pode ser encontrado no nosso github: [TODO: inserir link aqui]()

## Criando nosso projeto

Antes de mais nada baixe os assets para o jogo nesse link
[dodge_the_creeps_2d_assets.zip](https://github.com/godotengine/godot-docs-project-starters/releases/download/latest-4.x/dodge_the_creeps_2d_assets.zip). Vamos criar um novo projeto, seguiremos as mesmas etapas do capítulo 5 de scripts. Em uma pasta chamada `dodge-the-creeps` (ou o que você quiser).

### Configuração do Rust
Crie uma nova biblioteca do Rust: `cargo new rust --lib`. Entre nessa pasta e adicione a biblioteca do godot com `cargo add godot`. Agora, configure o arquivo `Cargo.toml` para que ele fique da seguinte forma:
```toml
[package]
name = "dodge_the_creeps"
version = "0.1.0"
edition = "2024"

[lib]
crate-type = ["cdylib"]

[dependencies]
godot = "0.2.4"
```
Feito isso, vamos adicionar o _boilerplate_ da biblioteca, substitua o código no arquivo `src/lib.rs` por este:
```rust
use godot::prelude::*;

struct GameExtension;

#[gdextension]
unsafe impl ExtensionLibrary for GameExtension {}
```
> Dei o nome de `GameExtension` para nossa extensão, mas você pode escolher o nome que preferir.

Isto feito, compile a biblioteca com `cargo build`. Se tudo deu certo, podemos ir para o _setup_ do Godot.

### Configuração do Godot

Abra o Godot e crie um novo projeto dentro da pasta raiz. Darei o nome do projeto de `Dodge the Creeps`, mas a pasta se chamará `godot`. Veja na imagem abaixo:

<img width="250" height="250" alt="tela de criação de projetos do godot" src="https://github.com/user-attachments/assets/138a5d13-9038-4b51-9eed-4e22cbede11f" />

Agora dentro da interface do Godot vamos configurar adicionar nossos _assets_,  mas antes precisamos configurar a _viewport_ (tamanho da tela) que nosso jogo terá. Em _Project_ > _Project Settings_>, encontre a aba _Display_ e clique na opção _Window_, modifique os atributos _Viewport width_ e _Viewport height_ para `480` e `720` respectivamente. Agora nas opções de _Stretch_, configure _Mode_ para `canvas_item` e _Aspect_ para `keep`. Desse modo, nossa tela vai se manter consistente para diferentes tamanhos de tela.

Voltando aos nossos assets, extraia os arquivos dentro da pasta `godot`, o resultado serão duas pastas, `fonts` e `art`. Usaremos esses recursos nas próximas etapas. O seus sistema de arquivos deve ficar da seguinte forma:

<img width="293" height="286" alt="sistema de arquivos do godot" src="https://github.com/user-attachments/assets/24dd0219-35aa-44e7-a366-6ea8dfa55d6c" />

Isso feito, crie um arquivo `DodgeTheCreeps.gdextension` e escreva as seguintes linhas.
```toml
[configuration]
entry_symbol = "gdext_rust_init"
compatibility_minimum = 4.1
reloadable = true

[libraries]
linux.debug.x86_64 =     "res://../rust/target/debug/libdodge_the_creeps.so"
linux.release.x86_64 =   "res://../rust/target/release/libdodge_the_creeps.so"
windows.debug.x86_64 =   "res://../rust/target/debug/dodge_the_creeps.dll"
windows.release.x86_64 = "res://../rust/target/release/dodge_the_creeps.dll"
macos.debug =            "res://../rust/target/debug/libdodge_the_creeps.dylib"
macos.release =          "res://../rust/target/release/libdodge_the_creeps.dylib"
macos.debug.arm64 =      "res://../rust/target/debug/libdodge_the_creeps.dylib"
macos.release.arm64 =    "res://../rust/target/release/libdodge_the_creeps.dylib"
```

Muito bem, com isso nosso projeto está configurado, vamos partir para as próximas etapas.

## Criando o jogador

Primeiro de tudo, vamos criar nosso jogador. Abra a interface do Godot, na árvore de nós, clique em `Other Node`, pesquise por `Area2D` e clique em criar. Ainda na árvore, renomeie o nó para `Player`. Antes de mais nada, precisamos agrupar os nós filhos de _Player_, na barra de tarefas busque pelo ícone **Agrupar**, ou aperte `Ctrl-G`.

<img width="687" height="83" alt="agroupar-nos-filhos" src="https://github.com/user-attachments/assets/1ecd9155-ec36-4054-95e0-8c8704d7fc7b" />

Feito isso, aperte `Ctrl-A` para criar um filho do nó raiz, selecione `AnimatedSprite2D`, esse nó vai cuidar das animações e sprite do jogador. Selecione esse nó na árvore e vá para a coluna de inspeção (_Inspector_), procure por `Animation` > `Sprite Frames`, clique para criar um novo _Sprite Frames_. Isto criará uma nova aba inferior chamada _SpriteFrames_, nela temos uma lista de animações, cada animação é um conjunto de _sprites_ (imagens), vamos criar duas animações. Renomeie a animação `default` para `walk` e crie uma nova animação chamada `up`. Para adicionar _sprites_ basta selecionar a animação e arrastar imagens para a tela maior. Vamos adicionar algumas imagens, procure na aba de _FileSystem_ a pasta `art`, arraste as seguintes imagens para suas respectivas animações:

- `playerGrey_walk1` e `playerGrey_walk2` para `walk`; e
- `playerGrey_up1` e `playerGrey_up2` para `up`.

<img width="1278" height="349" alt="Animacoes" src="https://github.com/user-attachments/assets/cf98cf1d-8f22-4bbe-bfb1-2403946d3833" />

Temos um pequeno detalhe, nossas imagens são meio grandes para a tela que definimos antes, então vamos reduzir as imagens em 50%. Ainda com o nó `AnimatedSprite2D` selecionado, volte para o _Inspector_, procure por `Transform` > `Scale`, ajuste ambas coordenadas para `0.5`.

<img width="284" height="484" alt="ajustar-escala-do-jogador" src="https://github.com/user-attachments/assets/605c8760-a1e4-49a9-9140-66ff0f1fafcd" />

Seguindo, vamos adicionar uma _hitbox_ para nosso jogador. Crie um nó do tipo `CollisionShape2D` e em `Shape` selecione `CapsuleShape2D`, uma elispse azul se formará no centro do nosso jogador. Dê um zoom na tela de visualização e ajuste essa elipse para cobrir a maior parte do jogador.

<img width="474" height="488" alt="resize-player" src="https://github.com/user-attachments/assets/c59c3fae-37a1-4957-99f7-37b22eb19612" />

O jogador está pronto, vamos salvar essa cena com `Ctrl-S` e dar o nome de `player.tscn`, nossa cena irá aparecer em _FileSystem_. Muito bem! Está na hora de programar algumas funcionalidades. De volta ao Rust!
 
### Programando o jogador
